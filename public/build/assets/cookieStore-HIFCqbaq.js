const w=decodeURIComponent,y=/; */;function b(n,t){try{return typeof t=="boolean"?decodeURIComponent(n):t(n)}catch{return n}}var c;(function(n){n.strict="strict",n.lax="lax",n.none="none"})(c||(c={}));function k(n,t={}){if(typeof n!="string")throw new TypeError("argument str must be a string");const o=[],i=t||{},s=n.split(y),a=i.decode||w;for(let e=0;e<s.length;e++){const r=s[e];let u=r.indexOf("=");if(u<0)continue;const p=r.substr(0,u).trim();let l=r.substr(++u,r.length).trim();l[0]=='"'&&(l=l.slice(1,-1)),o[p]==null&&o.push({name:p,value:b(l,a)})}return o}class f extends Event{constructor(t,o={changed:[],deleted:[]}){super(t,o),this.changed=o.changed||[],this.deleted=o.deleted||[]}}class d extends EventTarget{get[Symbol.toStringTag](){return"CookieStore"}constructor(){throw super(),new TypeError("Illegal Constructor")}async get(t){if(t==null)throw new TypeError("CookieStoreGetOptions must not be empty");if(t instanceof Object&&!Object.keys(t).length)throw new TypeError("CookieStoreGetOptions must not be empty");return(await this.getAll(t))[0]}async set(t,o){var i,s,a;const e={name:"",value:"",path:"/",secure:!1,sameSite:c.strict,expires:null,domain:null};if(typeof t=="string")e.name=t,e.value=o;else{if(Object.assign(e,t),e.path&&!e.path.startsWith("/"))throw new TypeError('Cookie path must start with "/"');if(!((i=e.domain)===null||i===void 0)&&i.startsWith("."))throw new TypeError('Cookie domain cannot start with "."');if(e.domain&&e.domain!==window.location.hostname)throw new TypeError("Cookie domain must domain-match current host");if(!((s=e.name)===null||s===void 0)&&s.startsWith("__Host")&&e.domain)throw new TypeError("Cookie domain must not be specified for host cookies");if(!((a=e.name)===null||a===void 0)&&a.startsWith("__Host")&&e.path!="/")throw new TypeError("Cookie path must not be specified for host cookies");e.path&&e.path.endsWith("/")&&(e.path=e.path.slice(0,-1)),e.path===""&&(e.path="/")}if(e.name===""&&e.value&&e.value.includes("="))throw new TypeError("Cookie value cannot contain '=' if the name is empty");e.name&&e.name.startsWith("__Host")&&(e.secure=!0);let r=`${e.name}=${encodeURIComponent(e.value)}`;switch(e.domain&&(r+="; Domain="+e.domain),e.path&&(r+="; Path="+e.path),typeof e.expires=="number"?r+="; Expires="+new Date(e.expires).toUTCString():e.expires instanceof Date&&(r+="; Expires="+e.expires.toUTCString()),(e.name&&e.name.startsWith("__Secure")||e.secure)&&(e.sameSite=c.lax,r+="; Secure"),e.sameSite){case c.lax:r+="; SameSite=Lax";break;case c.strict:r+="; SameSite=Strict";break;case c.none:r+="; SameSite=None";break}const u=await this.get(e);if(document.cookie=r,this.onchange){const p=[],l=[];u&&!await this.get(e)?l.push({...e,value:void 0}):p.push(e);const g=new f("change",{changed:p,deleted:l});this.onchange(g)}}async getAll(t){const o=k(document.cookie);if(t==null||Object.keys(t).length===0)return o;let i,s;if(typeof t=="string"?i=t:(i=t.name,s=t.url),s){const a=new URL(s,window.location.origin);if(window.location.href!==a.href||window.location.origin!==a.origin)throw new TypeError("URL must match the document URL");return o.slice(0,1)}return o.filter(a=>a.name===i)}async delete(t){const o={name:"",value:"",path:"/",secure:!1,sameSite:c.strict,expires:null,domain:null};typeof t=="string"?o.name=t:Object.assign(o,t),o.expires=0,await this.set(o)}}const h=new WeakMap,m=new WeakMap;class S{get[Symbol.toStringTag](){return"CookieStoreManager"}constructor(){throw new TypeError("Illegal Constructor")}async subscribe(t){const o=h.get(this)||[],i=m.get(this);if(!i)throw new TypeError("Illegal invocation");for(const s of t){const a=s.name,e=new URL(s.url||"",i.scope).toString();o.some(r=>r.name===a&&r.url===e)||o.push({name:s.name,url:e})}h.set(this,o)}async getSubscriptions(){return(h.get(this)||[]).map(({name:t,url:o})=>({name:t,url:o}))}async unsubscribe(t){let o=h.get(this)||[];const i=m.get(this);if(!i)throw new TypeError("Illegal invocation");for(const s of t){const a=s.name,e=new URL(s.url||"",i.scope).toString();o=o.filter(r=>r.name!==a||r.url!==e)}h.set(this,o)}}"cookies"in ServiceWorkerRegistration.prototype||Object.defineProperty(ServiceWorkerRegistration.prototype,"cookies",{configurable:!0,enumerable:!0,get(){const n=Object.create(S.prototype);return m.set(n,this),Object.defineProperty(this,"cookies",{value:n}),n}});const v=Object.create(d.prototype);globalThis.cookieStore||Object.assign(globalThis,{cookieStore:v,CookieStore:d,CookieChangeEvent:f});export{f as CookieChangeEvent,d as CookieStore,v as cookieStore};
