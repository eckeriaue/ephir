import{d as T,r as d,p as L,o,c as i,b as s,B as $,k as x,j as w,F as j,l as k,t as r,u as m,e as g,q as B,G as M,w as N,H as P,I as A,h as I,i as F,T as E}from"./app-9p3GCdfp.js";import{_ as V}from"./Posts-5FB0RNlf.js";import{a as H}from"./InputLabel-BBW5vzO6.js";import{e as S,i as U}from"./auth-ObAiEVHJ.js";import{_ as D}from"./_plugin-vue_export-helper-x3n3nnut.js";const q=c=>(P("data-v-04069a9d"),c=c(),A(),c),G={class:"min-h-0"},O=q(()=>s("h2",{class:"text-xs font-medium px-6 pb-2 uppercase"}," КОММЕНТАРИИ ",-1)),R={class:"text-gray-500 text-xs inline-block"},Z=["textContent"],z={class:"text-sm text-gray-800"},J=["datetime"],K=["inert"],Q=T({__name:"PostComments",props:{postId:{}},emits:["create"],setup(c,{emit:a}){const v=c,_=a,n=d(!0);async function p(f){m(n)||(n.value=!0);const e=await f;return n.value=!1,e}const l=d(),u=d("");async function h(){n.value=!0;const f=m(u);_("create",await S(`/posts/${v.postId}/comments/create`).post().auth().json({comment:f}).dispatch()),l.value=await p(y()),u.value=""}const C=new Intl.DateTimeFormat("ru-RU",{dateStyle:"long",timeStyle:"short",timeZone:"Europe/Moscow"});function y(){return S(`/posts/${v.postId}/comments`).get().query("limit",999).json().dispatch()}return L(async()=>{l.value=await p(y())}),(f,e)=>(o(),i("section",null,[s("div",G,[O,s("div",{class:$(["grid duration-500 transition-all",{"grid-rows-[0fr]":!l.value,"grid-rows-[1fr]":Array.isArray(l.value)}])},[x(M,{name:"list",tag:"ol",class:"space-y-4 px-6 min-h-0"},{default:w(()=>[(o(!0),i(j,null,B(l.value,t=>{var b;return o(),i("li",{key:t.id},[s("address",R,[k(" Автор: "),s("a",{role:"author",href:"#",textContent:r((b=t.user)==null?void 0:b.name)},null,8,Z)]),s("p",z,r(t.content),1),t.created_at?(o(),i("time",{key:0,datetime:new Date(t.created_at).toISOString(),class:"text-gray-500 text-[10px]"},r(m(C).format(new Date(t.created_at))),9,J)):g("",!0)])}),128))]),_:1})],2),s("form",{inert:n.value,class:$([{"opacity-50":n.value},"sticky bottom-0 flex items-center group w-full mt-6"]),action:"post",onSubmit:N(h,["prevent"])},[x(H,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),class:"h-[36px] grow rounded-t-none rounded-r-none",placeholder:"Напишите свой комментарий"},null,8,["modelValue"]),x(V,{class:"h-[36px] group-focus-within:border-b-lime-600 border-b-2 rounded-l-none"},{default:w(()=>[k("📨")]),_:1})],42,K)])]))}}),W=D(Q,[["__scopeId","data-v-04069a9d"]]),X=["data-id"],Y={class:"flex justify-between lg:items-center pb-6 flex-col lg:flex-row"},ee={class:"font-medium text-xl"},te=["datetime"],se=["innerHTML"],oe={class:"flex justify-between"},ae={key:0,class:"text-gray-500 text-xs inline-block"},ne=["textContent"],re={class:"flex items-center gap-x-2"},ie=["disabled"],le={key:1,title:"Авторизуйтесь, чтобы поставить лайк",class:"text-xs text-gray-600"},de=T({__name:"SinglePost",props:{id:{default:NaN},title:{default:""},likes_count:{},my_like:{},user:{default:()=>({})},comments_count:{},content:{default:""},created_at:{}},setup(c){const a=c,v=new Intl.DateTimeFormat("ru-RU",{dateStyle:"medium",timeZone:"Europe/Moscow"}),_=d(!1),n=d(!1),p=d(a.likes_count),l=d(a.my_like),u=d(a.comments_count),h=I(()=>m(l)&&"id"in m(l));async function C(){_.value=!0;const e=await S(`/posts/${a.id}/like`).post().json().auth().dispatch();p.value=e.likes,l.value=e.my_like,_.value=!1}const y=I(()=>a.created_at?v.format(new Date(a.created_at)):""),f=new Date(a.created_at).toISOString();return(e,t)=>(o(),i("article",{"data-id":e.$props.id,class:"text-gray-700 mb-7 bg-white rounded-xl p-6 border-b-2 border-gray-200"},[s("header",Y,[s("h1",ee,r(e.title),1),a.created_at?(o(),i("time",{key:0,class:"text-gray-500 text-xs",datetime:m(f)},r(y.value),9,te)):g("",!0)]),e.content?(o(),i("p",{key:0,class:"break-words mb-8",innerHTML:e.content},null,8,se)):g("",!0),s("footer",oe,[e.user&&"name"in e.user?(o(),i("address",ae,[k(" Автор: "),s("a",{rel:"author",href:"#",textContent:r(e.user.name)},null,8,ne)])):g("",!0),s("fieldset",re,[x(V,{onClick:t[0]||(t[0]=b=>n.value=!n.value)},{default:w(()=>[k(" 💬 "+r(u.value),1)]),_:1}),m(U)?(o(),i("button",{key:0,type:"button",disabled:_.value,class:$([{"bg-red-600 border-transparent  text-white   hover:bg-red-500 active:bg-red-700  focus:ring-2 focus:ring-red-500":h.value,"bg-white border-gray-300 text-gray-700 shadow-sm hover:bg-gray-50 focus:ring-2 focus:ring-lime-500":!h.value},"px-4 py-2 disabled:pointer-events-none border inline-flex items-center tracking-widest uppercase focus:outline-none rounded-md disabled:opacity-25 font-semibold text-xs focus:ring-offset-2 transition ease-in-out duration-150"]),onClick:C},r(h.value?"🤍":"❤️")+" "+r(p.value),11,ie)):(o(),i("span",le," ❤️ "+r(p.value),1))])]),x(E,null,{default:w(()=>[n.value?(o(),F(W,{key:0,onCreate:t[1]||(t[1]=b=>u.value+=1),"post-id":e.$props.id,class:"transition-all duration-500 overflow-hidden mt-6 -mx-6 -mb-6"},null,8,["post-id"])):g("",!0)]),_:1})],8,X))}}),_e=D(de,[["__scopeId","data-v-74153875"]]);export{_e as default};
