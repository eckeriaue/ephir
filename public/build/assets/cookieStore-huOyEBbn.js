const d=decodeURIComponent,w=/; */;function y(n,t){try{return typeof t=="boolean"?decodeURIComponent(n):t(n)}catch{return n}}function k(n,t={}){if(typeof n!="string")throw new TypeError("argument str must be a string");const o=[],e=t||{},r=n.split(w),i=e.decode||d;for(let a=0;a<r.length;a++){const s=r[a];let l=s.indexOf("=");if(l<0)continue;const u=s.substr(0,l).trim();let c=s.substr(++l,s.length).trim();c[0]=='"'&&(c=c.slice(1,-1)),o[u]==null&&o.push({name:u,value:y(c,i)})}return o}class m extends Event{constructor(t,o={changed:[],deleted:[]}){super(t,o),this.changed=o.changed||[],this.deleted=o.deleted||[]}}class f extends EventTarget{get[Symbol.toStringTag](){return"CookieStore"}constructor(){throw super(),new TypeError("Illegal Constructor")}async get(t){if(t==null)throw new TypeError("CookieStoreGetOptions must not be empty");if(t instanceof Object&&!Object.keys(t).length)throw new TypeError("CookieStoreGetOptions must not be empty");return(await this.getAll(t))[0]}async set(t,o){var a,s,l;const e={name:"",value:"",path:"/",secure:!1,sameSite:"strict",expires:null,domain:null};if(typeof t=="string")e.name=t,e.value=o;else{if(Object.assign(e,t),e.path&&!e.path.startsWith("/"))throw new TypeError('Cookie path must start with "/"');if((a=e.domain)!=null&&a.startsWith("."))throw new TypeError('Cookie domain cannot start with "."');if(e.domain&&e.domain!==window.location.hostname)throw new TypeError("Cookie domain must domain-match current host");if((s=e.name)!=null&&s.startsWith("__Host")&&e.domain)throw new TypeError("Cookie domain must not be specified for host cookies");if((l=e.name)!=null&&l.startsWith("__Host")&&e.path!="/")throw new TypeError("Cookie path must not be specified for host cookies");e.path&&e.path.endsWith("/")&&(e.path=e.path.slice(0,-1)),e.path===""&&(e.path="/")}if(e.name===""&&e.value&&e.value.includes("="))throw new TypeError("Cookie value cannot contain '=' if the name is empty");e.name&&e.name.startsWith("__Host")&&(e.secure=!0);let r=`${e.name}=${encodeURIComponent(e.value)}`;switch(e.domain&&(r+="; Domain="+e.domain),e.path&&(r+="; Path="+e.path),typeof e.expires=="number"?r+="; Expires="+new Date(e.expires).toUTCString():e.expires instanceof Date&&(r+="; Expires="+e.expires.toUTCString()),(e.name&&e.name.startsWith("__Secure")||e.secure)&&(e.sameSite="lax",r+="; Secure"),e.sameSite){case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break}const i=this.get(e);if(document.cookie=r,this.onchange){const u=[],c=[];i&&!await this.get(e)?c.push({...e,value:void 0}):u.push(e);const g=new m("change",{changed:u,deleted:c});this.onchange(g)}}async getAll(t){const o=k(document.cookie);if(t==null||Object.keys(t).length===0)return o;let e,r;if(typeof t=="string"?e=t:(e=t.name,r=t.url),r){const i=new URL(r,window.location.origin);if(window.location.href!==i.href||window.location.origin!==i.origin)throw new TypeError("URL must match the document URL");return o.slice(0,1)}return o.filter(i=>i.name===e)}async delete(t){const o={name:"",value:"",path:"/",secure:!1,sameSite:"strict",expires:null,domain:null};typeof t=="string"?o.name=t:Object.assign(o,t),o.expires=0,await this.set(o)}}const p=new WeakMap,h=new WeakMap;class b{get[Symbol.toStringTag](){return"CookieStoreManager"}constructor(){throw new TypeError("Illegal Constructor")}async subscribe(t){const o=p.get(this)||[],e=h.get(this);if(!e)throw new TypeError("Illegal invocation");for(const r of t){const i=r.name,a=new URL(r.url||"",e.scope).toString();o.some(s=>s.name===i&&s.url===a)||o.push({name:r.name,url:a})}p.set(this,o)}async getSubscriptions(){return(p.get(this)||[]).map(({name:t,url:o})=>({name:t,url:o}))}async unsubscribe(t){let o=p.get(this)||[];const e=h.get(this);if(!e)throw new TypeError("Illegal invocation");for(const r of t){const i=r.name,a=new URL(r.url||"",e.scope).toString();o=o.filter(s=>s.name!==i||s.url!==a)}p.set(this,o)}}"cookies"in ServiceWorkerRegistration.prototype||Object.defineProperty(ServiceWorkerRegistration.prototype,"cookies",{configurable:!0,enumerable:!0,get(){const n=Object.create(b.prototype);return h.set(n,this),Object.defineProperty(this,"cookies",{value:n}),n}});const S=Object.create(f.prototype);Reflect.has(globalThis,"cookieStore")||(globalThis.cookieStore=S,globalThis.CookieStore=f,globalThis.CookieChangeEvent=m);
